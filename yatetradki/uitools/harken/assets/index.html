<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Subtitle Editor</title>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.6.8/plyr.css" />
    <style>
        #container {
            display: flex;
            height: 100vh;
        }
        #player-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #subtitles {
            flex: 1;
            overflow-y: scroll;
            padding: 10px;
        }
        .subtitle {
            cursor: pointer;
            margin-bottom: 10px;
            padding: 5px;
        }
        .subtitle:hover {
            background-color: #eaeaea;
        }
    </style>
</head>
<body>
<div id="container">
    <div id="player-container">
        <audio id="player" playsinline controls>
            <source src="/media/by10m_03.mp3" type="audio/mp3" />
            <track kind="captions" label="English captions" src="/media/by10m_03.vtt" srclang="en" default />
        </audio>
    </div>
    <div id="subtitles">
        <!-- Subtitle lines will be added by JavaScript -->
    </div>
</div>

<script src="https://cdn.plyr.io/3.6.8/plyr.polyfilled.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize Plyr player
        const player = new Plyr('#player');

        // Fetch subtitles and populate the UI
        fetch('/media/by10m_03.vtt')
            .then(response => response.text())
            .then(data => {
                const subtitlesContainer = document.getElementById('subtitles');
                const regex = /(\d\d:\d\d:\d\d\.\d\d\d) --> (\d\d:\d\d:\d\d\.\d\d\d)\n([\s\S]*?)(?=\n\d\d:\d\d:\d\d\.\d\d\d --> \d\d:\d\d:\d\d\.\d\d\d|\n*$)/g;
                let match;
                while (match = regex.exec(data)) {
                    const [_, start, end, text] = match;
                    const div = document.createElement('div');
                    div.className = 'subtitle';
                    div.textContent = text.trim();
                    div.dataset.start = start;
                    div.addEventListener('click', function () {
                        player.currentTime = parseTime(this.dataset.start);
                    });
                    subtitlesContainer.appendChild(div);
                }
            });

        // Add event listener for Space key to toggle play/pause
        window.addEventListener('keydown', function (event) {
            if (event.code === 'Space') {
                event.preventDefault();
                player.togglePlay();
            }
        });
    });

    function parseTime(timeString) {
        const [hours, minutes, seconds] = timeString.split(':').map(parseFloat);
        return hours * 3600 + minutes * 60 + seconds;
    }
</script>
</body>
</html>
